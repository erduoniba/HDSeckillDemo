## iOSçµåŠ¨å²›å¼€å‘å®è·µ

### ä¸€ã€åŸºæœ¬æ¦‚è¿°

#### åè¯åŸºç¡€çŸ¥è¯†

> è‹¹æœåœ¨ iPhone 14 Pro ç³»åˆ—ä¸­å¢åŠ ä¸€ä¸ªçµåŠ¨å²›ï¼Œä¸»è¦ç›®çš„æ˜¯éšè—æŒ–å­”é€ å‹çš„é«˜ç«¯â€œæ„Ÿå¹å·å±â€ã€‚ é€šè¿‡åŠ¨ç”»çš„è§†è§‰å·®å¼‚ï¼Œç”¨æˆ·æ‰¾ä¸åˆ°åŸæ¥çš„æŒ–å­”å±ã€‚çµåŠ¨å²›æ˜¯ä¸€ç§å·§å¦™çš„è®¾è®¡ï¼Œæ¨¡ç³Šäº†è½¯ä»¶å’Œç¡¬ä»¶ä¹‹é—´çš„ç•Œé™ï¼Œå®ƒå¯ä»¥åœ¨**é”å±çš„æƒ…å†µ**ä¸‹æ ¹æ®ä¸åŒçš„åº”ç”¨ç¨‹åºæ“ä½œå’Œæç¤ºã€é€šçŸ¥å’Œæ´»åŠ¨å†…å®¹çš„éœ€æ±‚ï¼Œè‡ªåŠ¨æ”¹å˜å¤§å°å’Œå½¢çŠ¶ï¼Œå±•ç¤ºç”¨æˆ·å…³æ³¨çš„äº‹æƒ…ã€‚

![é»˜è®¤çŠ¶æ€](./Assets/ldd01.jpg)

![é•¿æŒ‰å±•å¼€çŠ¶æ€](./Assets/ldd02.jpg)



#### å¼€å‘åŸºç¡€çŸ¥è¯†

> 1ã€è®¾å¤‡åªæ”¯æŒiPhoneï¼Œå¹¶ä¸”æ˜¯æœ‰â€œè¯ä¸¸å±â€çš„iPhone14Proå’Œ14Pro Maxä¸Šï¼›
>
> 2ã€Maxç³»ç»Ÿç‰ˆæœ¬ã€ç¼–è¯‘å™¨åŠiOSç³»ç»Ÿç‰ˆæœ¬ï¼š>=MacOS12.4ã€>=Xcode14.0+beta4ã€>=iOS16.1+betaï¼›
>
> 3ã€ä½¿ç”¨ `ActivityKit` ç”¨äºé…ç½®ã€å¼€å§‹ã€æ›´æ–°ã€ç»“æŸå®ç° `Live Activity` èƒ½åŠ›ã€‚ä½¿ç”¨ `WidgetKit` ã€`SwiftUI` åœ¨`widget` å°ç»„ä»¶ä¸­åˆ›å»º  `Live Activity` çš„ç”¨æˆ·ç•Œé¢ï¼Œè¿™æ ·å°ç»„ä»¶å’Œ  `Live Activity` çš„ä»£ç æ˜¯å¯ä»¥å…±äº«ï¼›
>
> 4ã€`Live Activity` ç›®å‰åªèƒ½é€šè¿‡  `ActivityKit`  ä»ä¸»å·¥ç¨‹è·å–æ•°æ®ï¼Œæˆ–è€…ä» è¿œç¨‹é€šçŸ¥ è·å–æœ€æ–°æ•°æ®ï¼›æ— æ³•è®¿é—®ç½‘ç»œæˆ–è€…æ¥å—ä½ç½®æ›´æ–°ä¿¡æ¯
>
> 5ã€ `ActivityKit`  å’Œ è¿œç¨‹é€šçŸ¥æ¨é€ æ›´æ–°çš„æ•°æ®ä¸èƒ½è¶…è¿‡4KBï¼›
>
> 6ã€`Live Activity` å¯ä»¥ç»™ä¸åŒçš„æ§åˆ¶ç»‘å®šä¸åŒçš„ deeplinkï¼Œä½¿å…¶è·³è½¬åˆ°ä¸åŒçš„é¡µé¢ï¼›
>
> 7ã€`Live Activity` åœ¨ç”¨æˆ·ä¸»åŠ¨ç»“æŸå‰æœ€å¤šå­˜æ´»8å°æ—¶ï¼›
>
> 8ã€å·²ç»ç»“æŸçš„ `Live Activity`  åœ¨é”å±ä¹Ÿæœ€å¤šä¿ç•™4å°æ—¶ï¼Œæ‰€ä»¥ä¸€ä¸ª `Live Activity`  æœ€é•¿å¯ä»¥åœç•™12å°æ—¶ï¼›
>
> 9ã€æœ€å¤šåŒæ—¶å­˜åœ¨ä¸¤ç»„ `Live Activity` ï¼Œæ’åˆ—é¡ºåºå¾…å‘ç°



### äºŒã€é¡¹ç›®æ„æ€

è¿™é‡Œä»¥ç”µå•†å¸¸ç”¨çš„æŠ¢è´­å•†å“ä½œä¸ºå®è·µï¼ŒåŒ…å«çš„äº¤äº’æ–¹å¼ä¸»è¦æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š

1ã€ä¸»å·¥ç¨‹å•†å“èƒ½å±•ç¤ºåŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…å«å›¾ç‰‡ã€åç§°ã€ä»·æ ¼ã€å¼€æŠ¢æ—¶é—´ã€é¢„çº¦æŒ‰é’®ç­‰ï¼›

2ã€ä¸»å·¥ç¨‹è®°å½•å•†å“é¢„çº¦çŠ¶æ€åŠçµåŠ¨å²›çš„ä»»åŠ¡çŠ¶æ€ï¼Œé¿å…é‡å¤é¢„çº¦ï¼›

3ã€å¼€å¯é¢„çº¦åï¼Œåœ¨æ‰“å¼€Appçš„æƒ…å†µä¸‹ï¼ŒçµåŠ¨å²›çœ‹åˆ°è¯¥å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ”¯æŒç«‹å³æŠ¢è´­ï¼›



åŒ…å«äº†å¼€å‘çµåŠ¨å²›çš„åŸºç¡€çŸ¥è¯†ï¼š

1ã€ä¸»å·¥ç¨‹æ•°æ®é€šè¿‡  `ActivityKit`  æ¥å¯åŠ¨ã€æ›´æ–°ã€åœæ­¢çµåŠ¨å²› Widgetï¼›

2ã€çµåŠ¨å²› Widget çš„åŸºæœ¬å¸ƒå±€æ–¹å¼åŠå¼€å‘æ³¨æ„äº‹é¡¹ï¼›

3ã€çµåŠ¨å²› Widget ç‚¹å‡»è·³è½¬åˆ°ä¸»å·¥ç¨‹çš„äº‹ä»¶é€šè®¯ï¼›



### äºŒã€æ•ˆæœå±•ç¤º

![](./Assets/ldd_480.mov)



### å››ã€ä»£ç å®è·µ

#### 1ã€åˆ›å»ºä¸»å·¥ç¨‹åŠçµåŠ¨å²›Widgetå·¥ç¨‹

![é»˜è®¤çŠ¶æ€](./Assets/ldd03.jpg)

<img src="./Assets/ldd04.jpg" alt="é»˜è®¤çŠ¶æ€" style="zoom:100%;" /> 

åœ¨ä¸»å·¥ç¨‹çš„ `info.plist` æ–‡ä»¶ä¸­æ·»åŠ  `Supports Live Activities` å¹¶ä¸”è®¾ç½®ä¸º `YES`



#### 2ã€ç†Ÿæ‚‰ `ActivityKit` å¸¸ç”¨å¯¹è±¡åŠAPIï¼Œåˆ›å»ºåŸºæœ¬è§†å›¾

**æ•°æ®éƒ¨åˆ†ï¼ˆä¸»å·¥ç¨‹ï¼‰**ï¼šç»§æ‰¿ `ActivityAttributes` ï¼Œå®šä¹‰å¸¸ç”¨çš„æ•°æ®æ¥æ§åˆ¶æˆ–æ”¹å˜UIåŠçŠ¶æ€ã€‚è¿™é‡ŒåŒ…å«çš„å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸å˜çš„çŠ¶æ€ï¼Œå¯å˜çš„çŠ¶æ€éœ€è¦åœ¨ `ContentState` ä¸­å£°æ˜ã€‚

```swift
// SeckillProduct.swift

import Foundation
import ActivityKit

struct SeckillProductAttributes: ActivityAttributes {
    typealias SeckillProductState = ContentState
    public struct ContentState: Codable, Hashable {
	      // å¯å˜çš„å±æ€§éœ€è¦æ”¾åœ¨è¿™é‡Œï¼Œactivityè°ƒç”¨updateè¿›è¡Œæ•°æ®çš„æ›´æ–°
        var isSeckill: Bool
    }
    
    // ä¸€ä¸ªçµåŠ¨å²›ä»»åŠ¡çš„åˆå§‹åŒ–æ•°æ®ï¼Œæè¿°ä¸€äº›ä¸å¯å˜æ•°æ®
    let productId: String
    let name: String
    let price: String
    let image: String
    let countDown: Double
    let isSeckill: Bool
    
    init(productId: String, name: String,  price: String, image: String, countDown: Double, isSeckill: Bool = false) {
        self.productId = productId
        self.name = name
        self.price = price
        self.image = image
        self.countDown = countDown
        self.isSeckill = isSeckill
    }
}
```

**çµåŠ¨å²›å¸ƒå±€ï¼ˆWidgetå·¥ç¨‹ï¼‰**ï¼šç»§æ‰¿ `Widget` ï¼Œé€šè¿‡ `ActivityConfiguration` æ¥ç®¡ç†é”å±åŠçµåŠ¨å²›çš„å¸ƒå±€ã€‚

è¿™é‡ŒåŒ…å«äº†å¦‚ä½•ä»ä¸»å·¥ç¨‹è·å–æ•°æ®å±•ç¤ºåŠå°†ç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™ä¸»å·¥ç¨‹çš„ä»£ç ç¤ºä¾‹ï¼š

```swift
// HDSeckillAvtivityLiveActivity.swift

import ActivityKit
import WidgetKit
import SwiftUI

struct HDSeckillAvtivityLiveActivity: Widget {
    var body: some WidgetConfiguration {
        ActivityConfiguration(for: SeckillProductAttributes.self) { context in
            // é”å±ä¹‹åï¼Œæ˜¾ç¤ºçš„æ¡Œé¢é€šçŸ¥æ ä½ç½®ï¼Œè¿™é‡Œå¯ä»¥åšç›¸å¯¹å¤æ‚çš„å¸ƒå±€
            VStack {
                Text("Hello").multilineTextAlignment(.center)
            }
            .activityBackgroundTint(Color.cyan)
            .activitySystemActionForegroundColor(Color.black)
            
        } dynamicIsland: { context in
            // çµåŠ¨å²›çš„å¸ƒå±€ä»£ç 
            DynamicIsland {
                /*
                 è¿™é‡Œæ˜¯é•¿æŒ‰çµåŠ¨å²›åŒºåŸŸåå±•å¼€çš„UI
                 æœ‰å››ä¸ªåŒºåŸŸé™åˆ¶äº†å¸ƒå±€ï¼Œåˆ†åˆ«æ˜¯å·¦ã€å³ã€ä¸­é—´ï¼ˆç¡¬ä»¶ä¸‹æ–¹ï¼‰ã€åº•éƒ¨åŒºåŸŸ
                 è¿™é‡Œé‡‡å–å·¦è¾¹ä¸ºAppçš„Iconã€å³è¾¹ä¸ºä¸Šä¸‹å¸ƒå±€ï¼ˆå•†å“åç§°+å•†å“å›¾æ ‡ï¼‰ã€
                 ä¸­é—´ä¸ºç«‹å³è´­ä¹°æŒ‰é’®ï¼Œæ”¯æŒç‚¹å‡»deeplinkä¼ å‚å”¤èµ·Appã€
                 åº•éƒ¨ä¸ºä»·æ ¼å’Œå€’è®¡æ—¶åŒºåŸŸ
                 */
                DynamicIslandExpandedRegion(.leading) {
                    Image("zyg100").resizable().frame(width: 32, height: 32)
                }
                DynamicIslandExpandedRegion(.trailing) {
                    Text(context.attributes.name).font(.subheadline).multilineTextAlignment(.center)
                    Spacer(minLength: 8)
                    Image(systemName: context.attributes.image).multilineTextAlignment(.center)
                }
                DynamicIslandExpandedRegion(.center) {
                    // è¿™é‡Œçš„urlä¸€å®šè®°å¾—éœ€è¦ä¸­æ–‡ç¼–ç 
                    let url = "hdSeckill://seckill?productId=\(context.attributes.productId)&name=\(context.attributes.name)".addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)!
                    Link("ç«‹å³è´­ä¹°", destination: URL(string: url)!).foregroundColor(.red).font(.system(size: 24, weight: .bold))
                }
                DynamicIslandExpandedRegion(.bottom) {
                    VStack(alignment: .center, content: {
                        Spacer(minLength: 8)
                        Text("ä»·æ ¼\(context.attributes.price)").font(.subheadline)
                        Spacer(minLength: 8)
                        Text(Date().addingTimeInterval(context.attributes.countDown * 60), style: .timer).font(.system(size: 16, weight: .semibold)).multilineTextAlignment(.center)
                        
                    }).foregroundColor(.green)
                }
            } compactLeading: {
                // è¿™é‡Œæ˜¯çµåŠ¨å²›æœªè¢«å±•å¼€å·¦è¾¹çš„å¸ƒå±€ï¼Œè¿™é‡Œç”¨æ¥å±•ç¤ºAppçš„Icon
                Image("zyg100").resizable().frame(width: 32, height: 32)
            } compactTrailing: {
                // è¿™é‡Œæ˜¯çµåŠ¨å²›æœªè¢«å±•å¼€å³è¾¹çš„å¸ƒå±€ï¼Œè¿™é‡Œç”¨æ¥å•†å“çš„åç§°
                HStack {
                    Text(context.attributes.name).font(.subheadline)
                }
            } minimal: {
                // è¿™é‡Œæ˜¯çµåŠ¨å²›æœ‰å¤šä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå±•ç¤ºä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡ï¼Œä½ç½®åœ¨å³è¾¹çš„ä¸€ä¸ªåœ†åœˆåŒºåŸŸ
                // è¿™ç”¨æˆ·å±•ç¤ºå•†å“çš„å›¾æ ‡
                Image(systemName: context.attributes.image)
            }
            // ç‚¹å‡»æ•´ä¸ªåŒºåŸŸï¼Œé€šè¿‡deeplinkå°†æ•°æ®ä¼ é€’ç»™ä¸»å·¥ç¨‹ï¼Œåšç›¸åº”çš„ä¸šåŠ¡
            .widgetURL(URL(string: "http://www.apple.com"))
            .keylineTint(Color.red)
        }
    }
}
```

#### 3ã€åœ¨ä¸»å·¥ç¨‹åšå¥½åŸºæœ¬å¸ƒå±€åŠåˆå§‹åŒ–å•†å“æ•°æ®

**ï¼ˆä¸»å·¥ç¨‹ï¼‰**å¸ƒå±€éƒ¨åˆ†å› ä¸ºdemoå±•ç¤ºï¼Œç›´æ¥ä½¿ç”¨ `storyboard` å¿«é€Ÿå®Œæˆï¼š

<img src="./Assets/ldd05.jpg" alt="é»˜è®¤çŠ¶æ€" style="zoom:100%;" />

```swift
// ViewController.swift
private func initProducts() {
        let carId = "2022101101"
        let carIsSeckill = checkIsSeckill(productId: carId)
        let bicycleId = "2022101102"
        let bicycleIsSeckill = checkIsSeckill(productId: bicycleId)
        let basketballId = "2022101103"
        let basketballIsSeckill = checkIsSeckill(productId: basketballId)
        let car = SeckillProductAttributes(productId:carId, name: "Model Y", price: "29.8ä¸‡", image: "car.side.air.circulate", countDown: 60, isSeckill: carIsSeckill)
        let bicycle = SeckillProductAttributes(productId:bicycleId, name: "æ°¸ä¹…è‡ªè¡Œè½¦", price: "1200", image: "bicycle", countDown: 120, isSeckill: bicycleIsSeckill)
        let basketball = SeckillProductAttributes(productId:basketballId, name: "æ–¯ä¼¯ä¸ç¯®çƒ", price: "340", image: "basketball", countDown: 150, isSeckill: basketballIsSeckill)
        products.append(car)
        products.append(bicycle)
        products.append(basketball)
        
			  // åˆ¤æ–­æœ¬åœ°ç¼“å­˜å’Œç³»ç»ŸActiviKitçš„ä»»åŠ¡æ•°æ®æ¥æ˜¾ç¤ºå½“å‰åˆ—è¡¨
        if carIsSeckill {
            seckillButton0.setTitle("å·²é¢„çº¦", for: .normal)
        }
        if bicycleIsSeckill {
            seckillButton1.setTitle("å·²é¢„çº¦", for: .normal)
        }
        if basketballIsSeckill {
            seckillButton2.setTitle("å·²é¢„çº¦", for: .normal)
        }
    }
```

ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨ `ActivityKit` å°†æ•°æ®ä¼ é€’ç»™ çµåŠ¨å²› Widgetï¼š

```swift
// ViewController.swift
@IBAction func seckillAction(_ sender: UIButton) {
        if sender.tag >= products.count {
            return
        }
        
        if !ActivityAuthorizationInfo().areActivitiesEnabled {
            logToTextView(log: "ä¸æ”¯æŒçµåŠ¨å²›")
            return
        }
        
        let product = products[sender.tag]
        // åˆ¤æ–­ç³»ç»Ÿçš„activitiesæ˜¯å¦è¿˜æ‰§è¡Œè¯¥å•†å“çš„ä»»åŠ¡ï¼Œåªæœ‰æ˜¯åœ¨æ‰§è¡Œä¸­çš„ï¼Œæ‰è¿›è¡Œå–æ¶ˆæ“ä½œ
        if sender.titleLabel?.text == "å·²é¢„çº¦" {
            if let activityId = getSeckillActivityId(productId: product.productId) {
                for activity in Activity<SeckillProductAttributes>.activities where activity.id == activityId {
                    logToTextView(log: "å–æ¶ˆé¢„çº¦è´­ä¹°\(product.name)")
                    Task {
                        await activity.end(dismissalPolicy:.immediate)
                    }
                    sender.setTitle("é¢„çº¦æŠ¢è´­", for: .normal)
                }
            }
            return
        }
        
        logToTextView(log: "å¼€å§‹é¢„çº¦è´­ä¹°\(product.name)")
        do {
            // åˆå§‹åŒ–çŠ¶æ€ï¼ŒContentStateæ˜¯å¯å˜çš„å¯¹è±¡
            let initState = SeckillProductAttributes.ContentState(isSeckill: true)
            // åˆå§‹åŒ–çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ä¸å˜çš„æ•°æ®
            let activity = try Activity.request(attributes: product, contentState: initState)
            logToTextView(log: "activityId: \(activity.id)")
            sender.setTitle("å·²é¢„çº¦", for: .normal)
            // å°†å•†å“idå’Œæ´»åŠ¨idå…³è”èµ·æ¥ï¼Œæ–¹ä¾¿æŸ¥è¯¢åŠå–æ¶ˆæ“ä½œ
            saveSeckillState(productId: product.productId, activityId: activity.id)
        } catch {
            
        }
    }
```

åŒæ­¥ç®¡ç†æ´»åŠ¨æ•°æ®åŠç³»ç»Ÿactivitiesçš„çŠ¶æ€ï¼š

```swift
// ViewController.swift
extension ViewController {
    // ä¿ç•™å•†å“çš„é¢„çº¦çŠ¶æ€ï¼Œkeyæ˜¯å•†å“idï¼Œvalueæ˜¯activityçš„id
    static let seckillProductIds = "com.harry.toolbardemo.seckillProductIds"
    
    private func checkIsSeckill(productId: String) -> Bool {
        if let ids = UserDefaults.standard.value(forKey: ViewController.seckillProductIds) as? [String: String] {
            // æœ¬åœ°ç¼“å­˜åŒ…å«è¯¥å•†å“IDï¼Œå¹¶ä¸”ç³»ç»Ÿçš„Activityä¾æ—§å­˜åœ¨
            if ids.keys.contains(productId) {
                for activity in Activity<SeckillProductAttributes>.activities where activity.id == ids[productId] {
                    return true
                }
            }
        }
        return false
    }
    
    private func saveSeckillState(productId: String, activityId: String) {
        var ids = [String: String]()
        if let tempIds = UserDefaults.standard.value(forKey: ViewController.seckillProductIds) as? [String: String] {
            ids = tempIds
        }
        ids[productId] = activityId
        UserDefaults.standard.set(ids, forKey: ViewController.seckillProductIds)
    }
    
    private func getSeckillActivityId(productId: String) -> String? {
        if let ids = UserDefaults.standard.value(forKey: ViewController.seckillProductIds) as? [String: String] {
            return ids[productId]
        }
        return nil
    }
    
    private func removeSeckillActivityId(productId: String) {
        if var ids = UserDefaults.standard.value(forKey: ViewController.seckillProductIds) as? [String: String] {
            ids.removeValue(forKey: productId)
            UserDefaults.standard.set(ids, forKey: ViewController.seckillProductIds)
        }
    }
}
```

#### 4ã€è§£æçµåŠ¨å²› Widgetçš„æ•°æ®ï¼Œå¹¶ä¸”åšç›¸åº”çš„æ“ä½œ

**ï¼ˆä¸»å·¥ç¨‹ä¸­ï¼‰**å¤–éƒ¨å”¤èµ·ä¼šæ‰§è¡Œåˆ° `SceneDelegate` æˆ–è€… `AppDelegate` çš„ç³»ç»ŸAPIä¸­ï¼Œè¿™é‡Œä»¥ ``SceneDelegate`` ä¸ºä¾‹è¯´æ˜ï¼š

```swift
// SceneDelegate.swift

// å®ç°è¯¥æ–¹æ³•ï¼Œæ¥æ”¶å¹¶ä¸”å¤„ç†å¤–éƒ¨å”¤èµ·çš„æ•°æ®åšç›¸åº”çš„äº‹ä»¶
func scene(_ scene: UIScene, openURLContexts URLContexts: Set<UIOpenURLContext>) {
    if let url = URLContexts.first?.url {
        debugPrint("url: \(url)")
        if url.scheme == "hdSeckill" {
            // é€šè¿‡schemeæ¥åŒºåˆ†çµåŠ¨å²›ç›¸å…³çš„æ•°æ®
            ActivityBrigde.activityAction(url: url)
        }
    }
}

// SeckillProduct.swift
// è§£æçµåŠ¨å²›çš„ä¼ é€’æ•°æ®ï¼Œåšç›¸åº”çš„äº‹ä»¶ï¼Œè¿™é‡Œé€šè¿‡é€šçŸ¥ç»™ä¸»å·¥ç¨‹çš„æ§åˆ¶å™¨æ‰§è¡Œç›¸åº”ä»»åŠ¡
struct ActivityBrigde {
    @discardableResult
    public static func activityAction(url: URL) -> Bool {
        let host = url.host
        guard host != nil else { return false }
        let queryItems = URLComponents(string: url.absoluteString)?.queryItems
        guard let queryItems = queryItems else { return false }
        var productId : String?
        var name : String?
        for item in queryItems {
            // è·å–å•†å“idå’Œåç§°
            if item.name == "productId" {
                productId = item.value
            }
            else if item.name == "name" {
                name = item.value
            }
        }
        guard let productId = productId else { return false }
        debugPrint("ç«‹å³æŠ¢è´­[\(name ?? "")] \(productId)")
        
        let info = [
            "productId": productId,
            "name": name ?? ""
        ]
        NotificationCenter.default.post(name: Notification.Name("liveActivityNotif"), object: nil, userInfo: info)
        
        return true
    }
}
```

**ï¼ˆä¸»å·¥ç¨‹ä¸­ï¼‰** ä¸»æ§åˆ¶å™¨ç›‘å¬è¯¥é€šçŸ¥ï¼Œå¹¶ä¸”åšç›¸åº”çš„ä»»åŠ¡å¤„ç†ï¼š

```swift
//  ViewController.swift

override func viewDidLoad() {
    super.viewDidLoad()
    NotificationCenter.default.addObserver(self, selector: #selector(liveActivityNotif(notif:)), name: Notification.Name("liveActivityNotif"), object: nil)
}

extension ViewController {
    @objc private func liveActivityNotif(notif: Notification) {
        if let userInfo = notif.userInfo {
            if let productId = userInfo["productId"] as? String, let name = userInfo["name"] as? String {
                logToTextView(log: "ç«‹å³æŠ¢è´­[\(name)] \(productId) \n")
            }
        }
    }
    
    private func logToTextView(log: String) {
        debugPrint(log);
        logTextView.text.append("\(log) \n")
        logTextView.scrollRectToVisible(CGRect(x: 0, y: logTextView.contentSize.height - 10, width: logTextView.contentSize.width, height: 10), animated: true)
    }
}
```



### **äº”ã€å°ç»“**

æ•´ä½“çš„å¼€å‘æˆæœ¬è¿˜æ˜¯å¾ˆä½ï¼ŒåŸºæœ¬ä¸ŠæŒ‰ç…§åæ–‡æœ‰å‡ ç¯‡ä¼˜ç§€çš„åšå®¢æ“ä½œå³å¯å®Œæˆå±äºè‡ªå·±æƒ³æ³•çš„çµåŠ¨å²›ã€‚ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ `Widget` å’Œ `SwiftUI` å¼€å‘çš„iOSåŒå­¦ä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚ç›¸ä¿¡åœ¨ä¸åŒç±»å‹çš„åº”ç”¨ä¸­ï¼Œå¤§å®¶è‚¯å®šä¹Ÿèƒ½å¤Ÿæ‰¾åˆ°å±äºè‡ªå·±çš„çµæ„Ÿç»™ç”¨æˆ·æ›´é«˜çš„ä½“éªŒæ„Ÿã€‚

æœ¬æ–‡æ¶‰åŠåˆ°çš„ä»£ç åœ°å€ä¸º [HDSeckillDemo](https://github.com/erduoniba/HDSeckillDemo) æ¬¢è¿å¤§å®¶ ğŸŒŸStar ğŸŒŸ



### å…­ã€å‚è€ƒé“¾æ¥

[ActivityKitå®˜æ–¹æ–‡æ¡£](https://developer.apple.com/documentation/activitykit/displaying-live-data-with-live-activities)

[iOS 16 Live Activity](https://mp.weixin.qq.com/s/aKD-WBYHsepg96zOC378cg)

[iOS16.1çµåŠ¨å²›é€‚é… (ActivityKit åˆæ¢)](https://juejin.cn/post/7144268555779850248)

[å®æ—¶æ´»åŠ¨(Live Activity) - åœ¨é”å®šå±å¹•å’ŒçµåŠ¨å²›ä¸Šæ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„å®æ—¶æ•°æ®](https://juejin.cn/post/7144268555779850248)

[Dynamic Island API - iOS 16.1 Beta - Xcode 14.1 - SwiftUI Tutorials](https://youtu.be/gEWvV-TmjqE)

[å¯èƒ½æ˜¯å…¨ç½‘ç¬¬ä¸€ä¸ªé€‚é…iOSçµåŠ¨å²›çš„Toaståº“-JFPopup](https://juejin.cn/post/7145630021372084232)